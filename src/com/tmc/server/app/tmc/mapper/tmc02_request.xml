<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  

<mapper namespace="tmc02_request">

<resultMap 	id="mapper" type="com.tmc.client.app.tmc.model.RequestModel" >

	<id  	column="tmc02_request_id"  		property="requestId"/>
	<result column="tmc02_patient_id"  		property="patientId"/>

	<result column="tmc02_request_type_cd"  property="requestTypeCode"/>
	<result column="tmc02_request_user_id"  property="requestUserId"/>
	<result column="tmc02_request_date"  	property="requestDate"/>
	<result column="tmc02_request_note"  	property="requestNote"/>

	<result column="tmc02_treat_date"  		property="treatDate"/>
	<result column="tmc02_treat_user_id"  	property="treatUserId"/>
	<result column="tmc02_treat_note"  		property="treatNote"/>

	<result column="tmc02_reg_user_id"  	property="regUserId"/>
	<result column="tmc02_reg_date"  		property="regDate"/>
	
	<!--  request user  
	<result column="req_sys02_user_id" 		property="request_user_userId"/>
	<result column="req_sys02_company_id"	property="request_user_companyId"/>
	<result column="req_sys02_kor_nm"		property="request_user_korName"/>
	-->
	
	
	<association property="patientModel" 
		javaType="com.tmc.client.app.tmc.model.PatientModel" 
		resultMap="tmc01_patient.mapper"
	/>

	<association property="requestUserModel" columnPrefix="req_"
		javaType="com.tmc.client.app.sys.model.UserModel" 
		resultMap="sys02_user.mapper"
	/>

	<association property="treatUserModel" columnPrefix="treat_user_"
		javaType="com.tmc.client.app.sys.model.UserModel" 
		resultMap="sys02_user.mapper"
	/>

	<association property="regUserModel" columnPrefix="reg_user_"
		javaType="com.tmc.client.app.sys.model.UserModel" 
		resultMap="sys02_user.mapper"
	/>
</resultMap>

<select id="selectById" resultMap="mapper" parameterType="Long" > 
	select 	tmc01_patient.*, 
			tmc02_request.*,  
			request_user.sys02_company_id req_sys02_company_id, 
			request_user.sys02_user_id req_sys02_user_id,
			request_user.sys02_kor_nm req_sys02_kor_nm,
			treat_user.*,
			reg_user.*,
			dbo.f_cdnm('GenderCode', tmc01_gender_cd) tmc01_gender_nm
	from 	tmc02_request 
			join tmc01_patient 
				on tmc02_patient_id = tmc01_patient_id  
			join sys02_user request_user 
				on tmc02_request_user_id = request_user.sys02_user_id 
			join sys02_user reg_user  
				on tmc02_reg_user_id = reg_user.sys02_user_id
			left outer join sys02_user treat_user 
				on tmc02_reg_user_id = treat_user.sys02_user_id
	where 	tmc02_request_id = #{requestId} 
</select>

<select id="selectByPatientId" resultMap="mapper" parameterType="Long" > 
	select 	tmc01_patient.*, 

			request_user.sys02_company_id 	req_sys02_company_id, 
			request_user.sys02_user_id 		req_sys02_user_id,
			 request_user.sys02_kor_nm 		req_sys02_kor_nm,

			request_user.*, 
			treat_user.*,
			reg_user.*,
			dbo.f_cdnm('GenderCode', tmc01_gender_cd) tmc01_gender_nm
	from 	tmc02_request 
			join tmc01_patient 
				on tmc02_patient_id = tmc01_patient_id  
			join sys02_user request_user 
				on tmc02_request_user_id = request_user.sys02_user_id 
			join sys02_user reg_user  
				on tmc02_reg_user_id = reg_user.sys02_user_id
			left join sys02_user treat_user 
				on tmc02_reg_user_id = treat_user.sys02_user_id
	where 	tmc02_patient_id = #{patientId}
	order 	by tmc02_request_date
</select>

<select id="selectByCompanyId" resultMap="mapper" parameterType="Long"> 
	select 	tmc01_patient.*, 
			request_user.sys02_company_id 	req_sys02_company_id, 
			request_user.sys02_user_id 		req_sys02_user_id,
			request_user.sys02_kor_nm 		req_sys02_kor_nm,
			tmc02_request.*,  
			request_user.*,  
			treat_user.*,
			reg_user.*,
			dbo.f_cdnm('GenderCode', tmc01_gender_cd) tmc01_gender_nm
	from 	tmc02_request 
			join tmc01_patient 
				on tmc02_patient_id = tmc01_patient_id  
			join sys02_user request_user 
				on tmc02_request_user_id = request_user.sys02_user_id 
			join sys02_user reg_user  
				on tmc02_reg_user_id = reg_user.sys02_user_id
			left outer join sys02_user treat_user 
				on tmc02_reg_user_id = treat_user.sys02_user_id
	where 	tmc01_company_id = #{companyId}
	order 	by tmc02_request_date
</select>

</mapper>